<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin/layout}" lang="ko">

<div layout:fragment="content">
    <!-- Content Header -->
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">부동산정보 관리</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="/admin/dashboard">대시보드</a></li>
                        <li class="breadcrumb-item">시스템 관리</li>
                        <li class="breadcrumb-item active">부동산정보 관리</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="card card-warning card-outline">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-building mr-1"></i>
                                부동산 회사 정보
                            </h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <form id="companyInfoForm" method="post">
                                <!-- 기본 정보 섹션 -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="businessName">상호명 <span class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fas fa-store"></i></span>
                                                </div>
                                                <input type="text" class="form-control" id="businessName" name="businessName"
                                                       value="범부동산중개사무소" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="phoneNumber">대표 전화번호 <span class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                                </div>
                                                <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber"
                                                       value="055-237-1239" placeholder="055-000-0000" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 주소 정보 섹션 -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="address1">주소 1 <span class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                                                </div>
                                                <input type="text" class="form-control" id="address1" name="address1"
                                                       value="경남 창원시 성산구 대원동 36-5" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="address2">주소 2 (상세주소)</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                                                </div>
                                                <input type="text" class="form-control" id="address2" name="address2"
                                                       value="경남 창원시 성산구 대원로 87 센트럴스페어 104호 농협은행앞">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="directions">찾아오는 길</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fas fa-route"></i></span>
                                                </div>
                                                <input type="text" class="form-control" id="directions" name="directions"
                                                       value="대원초등학교 도보 1분 센트럴스페어 104호 농협은행앞">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="faxNumber">팩스 번호</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fas fa-fax"></i></span>
                                                </div>
                                                <input type="tel" class="form-control" id="faxNumber" name="faxNumber"
                                                       placeholder="055-000-0000">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <hr class="my-4">

                                <!-- 담당자 정보 섹션 -->
                                <h5 class="mb-3">
                                    <i class="fas fa-user-tie mr-1"></i>
                                    담당자 정보
                                </h5>

                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="managerName">담당자 이름 <span class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                                                </div>
                                                <input type="text" class="form-control" id="managerName" name="managerName"
                                                       value="홍길동" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="managerPosition">담당자 직급</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fas fa-id-badge"></i></span>
                                                </div>
                                                <input type="text" class="form-control" id="managerPosition" name="managerPosition"
                                                       value="대표(CEO)">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="managerPhone">담당자 연락처 <span class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fas fa-mobile-alt"></i></span>
                                                </div>
                                                <input type="tel" class="form-control" id="managerPhone" name="managerPhone"
                                                       value="010-6565-9400" placeholder="010-0000-0000" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="managerEmail">담당자 이메일</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                                </div>
                                                <input type="email" class="form-control" id="managerEmail" name="managerEmail"
                                                       placeholder="manager@beomproperty.com">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="managerPhoto">담당자 사진</label>
                                            <div class="input-group">
                                                <div class="custom-file">
                                                    <input type="file" class="custom-file-input" id="managerPhoto" name="managerPhoto" accept="image/*">
                                                    <label class="custom-file-label" for="managerPhoto">파일 선택</label>
                                                </div>
                                                <div class="input-group-append">
                                                    <button class="btn btn-outline-warning" type="button" id="uploadPhoto">
                                                        <i class="fas fa-upload"></i> 업로드
                                                    </button>
                                                </div>
                                            </div>
                                            <small class="form-text text-muted">JPG, PNG 파일만 업로드 가능합니다.</small>
                                            <div id="photoPreview" class="mt-2" style="display: none;">
                                                <img id="previewImage" src="" alt="미리보기" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mt-4">
                                    <div class="col-12">
                                        <div class="float-right">
                                            <button type="button" class="btn btn-secondary mr-2" onclick="resetForm()">
                                                <i class="fas fa-undo"></i> 초기화
                                            </button>
                                            <button type="submit" class="btn btn-warning">
                                                <i class="fas fa-save"></i> 저장하기
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<th:block layout:fragment="scripts">
<script>
$(document).ready(function() {
    // Custom file input
    $('.custom-file-input').on('change', function() {
        const fileName = $(this).val().split('\\').pop();
        $(this).siblings('.custom-file-label').addClass("selected").html(fileName);

        // 이미지 미리보기
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                $('#previewImage').attr('src', e.target.result);
                $('#photoPreview').show();
            };
            reader.readAsDataURL(this.files[0]);
        }
    });

    // 폼 제출 처리
    $('#companyInfoForm').on('submit', function(e) {
        e.preventDefault();

        // 유효성 검사
        if (!validateForm()) {
            return;
        }

        // 저장 처리 (실제로는 AJAX로 서버에 전송)
        const formData = new FormData(this);

        // 로딩 상태 표시
        const submitBtn = $(this).find('button[type="submit"]');
        const originalText = submitBtn.html();
        submitBtn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> 저장 중...');

        // 시뮬레이션 (실제로는 서버 통신)
        setTimeout(() => {
            submitBtn.prop('disabled', false).html(originalText);

            // 성공 알림
            $(document).Toasts('create', {
                class: 'bg-success',
                title: '저장 완료',
                subtitle: '부동산 정보',
                body: '부동산 정보가 성공적으로 저장되었습니다.',
                autohide: true,
                delay: 3000
            });
        }, 1500);
    });

    // 업로드 버튼 클릭
    $('#uploadPhoto').on('click', function() {
        $('#managerPhoto').click();
    });
});

function validateForm() {
    const requiredFields = ['businessName', 'phoneNumber', 'address1', 'managerName', 'managerPhone'];
    let isValid = true;

    requiredFields.forEach(function(fieldName) {
        const field = $(`[name="${fieldName}"]`);
        if (!field.val().trim()) {
            field.addClass('is-invalid');
            isValid = false;
        } else {
            field.removeClass('is-invalid');
        }
    });

    if (!isValid) {
        $(document).Toasts('create', {
            class: 'bg-warning',
            title: '입력 오류',
            body: '필수 항목을 모두 입력해주세요.',
            autohide: true,
            delay: 3000
        });
    }

    return isValid;
}

function resetForm() {
    if (confirm('모든 변경사항이 초기화됩니다. 계속하시겠습니까?')) {
        document.getElementById('companyInfoForm').reset();
        $('#photoPreview').hide();
        $('.custom-file-label').removeClass("selected").html("파일 선택");
        $('.form-control').removeClass('is-invalid');
    }
}
</script>
</th:block>
</html>
