<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin/layout}">

<th:block layout:fragment="styles">
    <!-- Select2 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2-bootstrap-theme/0.1.0-beta.10/select2-bootstrap.min.css">

    <!-- Summernote CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote-bs4.min.css">

    <style>
        .form-section {
            margin-bottom: 1.5rem;
        }

        .image-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 0.375rem;
            padding: 3rem;
            text-align: center;
            background-color: #f8f9fa;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .image-upload-area:hover {
            border-color: #007bff;
            background-color: #e3f2fd;
        }

        .image-upload-area.dragover {
            border-color: #28a745;
            background-color: #d4edda;
        }

        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }

        .image-preview {
            position: relative;
            width: 150px;
            height: 150px;
            border-radius: 0.375rem;
            overflow: hidden;
            border: 2px solid #dee2e6;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(220, 53, 69, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-remove:hover {
            background: rgba(220, 53, 69, 1);
        }

        .progress-steps {
            display: flex;
            margin-bottom: 2rem;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            padding: 0.75rem;
            background: #e9ecef;
            border-right: 1px solid #dee2e6;
            position: relative;
        }

        .progress-step:first-child {
            border-radius: 0.375rem 0 0 0.375rem;
        }

        .progress-step:last-child {
            border-radius: 0 0.375rem 0.375rem 0;
            border-right: none;
        }

        .progress-step.active {
            background: #007bff;
            color: white;
            font-weight: 600;
        }

        .progress-step.completed {
            background: #28a745;
            color: white;
        }

        .required-field::after {
            content: " *";
            color: #dc3545;
        }

        .invalid-feedback {
            display: block;
        }

        .form-control.is-invalid,
        .select2-container .select2-selection.is-invalid {
            border-color: #dc3545;
        }

        .select2-container--bootstrap .select2-selection {
            border-color: #ced4da;
        }
    </style>
</th:block>

<!-- Content Header -->
<div layout:fragment="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1><i class="fas fa-plus-circle mr-2"></i>매물 등록</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="/"><i class="fas fa-home"></i> 홈</a></li>
                    <li class="breadcrumb-item"><a href="/admin/properties/list">매물 목록</a></li>
                    <li class="breadcrumb-item active">매물 등록</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div layout:fragment="content">
            <!-- Progress Steps -->
            <div class="progress-steps">
                <div class="progress-step active" id="step1">
                    <i class="fas fa-info-circle mr-2"></i>기본 정보
                </div>
                <div class="progress-step" id="step2">
                    <i class="fas fa-won-sign mr-2"></i>가격 정보
                </div>
                <div class="progress-step" id="step3">
                    <i class="fas fa-images mr-2"></i>이미지 등록
                </div>
            </div>

            <form id="propertyRegisterForm" enctype="multipart/form-data" novalidate>
                <!-- Step 1: 기본 정보 -->
                <div class="step-content" id="stepContent1">
                    <!-- 매물 기본 정보 -->
                    <div class="card form-section">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-building mr-2"></i>매물 기본 정보</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="required-field">매물 종류</label>
                                        <select class="form-control select2" name="propertyType" id="propertyType" required>
                                            <option value="">매물 종류를 선택하세요</option>
                                            <option value="APARTMENT">아파트</option>
                                            <option value="VILLA">빌라</option>
                                            <option value="ONE_ROOM">원룸</option>
                                            <option value="TWOTHREE_ROOM">투룸/쓰리룸</option>
                                            <option value="COMMERCIAL">상가/사무실</option>
                                            <option value="STORE">점포</option>
                                        </select>
                                        <div class="invalid-feedback">매물 종류를 선택해주세요.</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="required-field">거래 유형</label>
                                        <select class="form-control select2" name="transactionType" required>
                                            <option value="">거래 유형을 선택하세요</option>
                                            <option value="SALE">매매</option>
                                            <option value="JEONSE">전세</option>
                                            <option value="MONTHLY">월세</option>
                                        </select>
                                        <div class="invalid-feedback">거래 유형을 선택해주세요.</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="required-field">주소</label>
                                        <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="postalCode" name="postalCode" placeholder="우편번호" readonly>
                                            <div class="input-group-append">
                                                <button type="button" class="btn btn-outline-secondary" id="addressSearchBtn">
                                                    <i class="fas fa-search"></i> 주소 검색
                                                </button>
                                            </div>
                                        </div>
                                        <input type="text" class="form-control mb-2" id="roadAddress" name="roadAddress" placeholder="도로명 주소" readonly>
                                        <input type="text" class="form-control mb-2" id="jibunAddress" name="jibunAddress" placeholder="지번 주소" readonly>
                                        <input type="text" class="form-control" id="address" name="address" placeholder="기본 주소 (자동입력)" readonly required>
                                        <div class="invalid-feedback">주소를 입력해주세요.</div>
                                        <!-- Hidden fields for coordinates -->
                                        <input type="hidden" id="latitude" name="latitude">
                                        <input type="hidden" id="longitude" name="longitude">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>상세 주소</label>
                                        <input type="text" class="form-control" id="detailAddress" name="detailAddress" placeholder="상세 주소를 입력하세요 (예: 101호)">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 추가 정보 (동적 필드) -->
                    <div class="card form-section">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-cogs mr-2"></i>추가 정보</h3>
                        </div>
                        <div class="card-body" id="dynamicFields">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle mr-2"></i>
                                매물 종류를 선택하면 해당하는 추가 정보 필드가 표시됩니다.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: 가격 정보 -->
                <div class="step-content" id="stepContent2" style="display: none;">
                    <div class="card form-section">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-won-sign mr-2"></i>가격 정보</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>매매가</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" name="price" placeholder="0" min="0">
                                            <div class="input-group-append">
                                                <span class="input-group-text">만원</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>보증금</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" name="deposit" placeholder="0" min="0">
                                            <div class="input-group-append">
                                                <span class="input-group-text">만원</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>월세</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" name="monthlyRent" placeholder="0" min="0">
                                            <div class="input-group-append">
                                                <span class="input-group-text">만원</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>관리비</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" name="maintenanceFee" placeholder="0" min="0">
                                            <div class="input-group-append">
                                                <span class="input-group-text">만원</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>입주 가능일</label>
                                        <input type="date" class="form-control" name="moveInDate">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 상세 설명 -->
                    <div class="card form-section">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-align-left mr-2"></i>상세 설명</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>매물 설명</label>
                                <textarea id="summernote" name="description" class="form-control"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: 이미지 등록 -->
                <div class="step-content" id="stepContent3" style="display: none;">
                    <div class="card form-section">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-images mr-2"></i>매물 이미지</h3>
                        </div>
                        <div class="card-body">
                            <div class="image-upload-area" id="imageUploadArea">
                                <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                <h4 class="text-muted">이미지를 업로드하세요</h4>
                                <p class="text-muted mb-0">클릭하거나 이미지를 여기로 드래그하세요</p>
                                <p class="text-muted"><small>JPG, PNG 파일만 업로드 가능 (최대 10MB)</small></p>
                                <input type="file" id="imageFiles" name="images" multiple accept="image/*" style="display: none;">
                            </div>
                            <div class="image-preview-container" id="imagePreviewContainer"></div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">
                                    <i class="fas fa-chevron-left mr-2"></i>이전
                                </button>
                            </div>
                            <div class="col-md-6 text-right">
                                <button type="button" class="btn btn-primary" id="nextBtn">
                                    다음 <i class="fas fa-chevron-right ml-2"></i>
                                </button>
                                <button type="submit" class="btn btn-success" id="submitBtn" style="display: none;">
                                    <i class="fas fa-save mr-2"></i>등록하기
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
</div>

<!-- Scripts -->
<th:block layout:fragment="scripts">
    <!-- Summernote -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote-bs4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/lang/summernote-ko-KR.min.js"></script>

    <!-- Daum Postcode API -->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

        <script>
        /*<![CDATA[*/
        $(document).ready(function() {
            let currentStep = 1;
            const totalSteps = 3;
            let selectedImages = [];

            // Initialize components
            initializeSelect2();
            initializeSummernote();
            initializeImageUpload();
            initializeStepNavigation();
            initializeFormValidation();
            initializeDynamicFields();
            initializeAddressSearch();

            // Select2 초기화
            function initializeSelect2() {
                $('.select2').select2({
                    theme: 'bootstrap',
                    width: '100%'
                });
            }

            // Summernote 초기화
            function initializeSummernote() {
                $('#summernote').summernote({
                    height: 300,
                    lang: 'ko-KR',
                    toolbar: [
                        ['style', ['style']],
                        ['font', ['bold', 'italic', 'underline', 'clear']],
                        ['fontname', ['fontname']],
                        ['color', ['color']],
                        ['para', ['ul', 'ol', 'paragraph']],
                        ['table', ['table']],
                        ['insert', ['link', 'picture', 'video']],
                        ['view', ['fullscreen', 'codeview', 'help']]
                    ]
                });
            }

            // 이미지 업로드 초기화
            function initializeImageUpload() {
                const uploadArea = $('#imageUploadArea');
                const fileInput = $('#imageFiles');

                // 클릭 이벤트
                uploadArea.on('click', function() {
                    fileInput.click();
                });

                // 파일 선택 이벤트
                fileInput.on('change', function() {
                    handleFiles(this.files);
                });

                // 드래그 앤 드롭 이벤트
                uploadArea.on('dragover', function(e) {
                    e.preventDefault();
                    $(this).addClass('dragover');
                });

                uploadArea.on('dragleave', function(e) {
                    e.preventDefault();
                    $(this).removeClass('dragover');
                });

                uploadArea.on('drop', function(e) {
                    e.preventDefault();
                    $(this).removeClass('dragover');
                    const files = e.originalEvent.dataTransfer.files;
                    handleFiles(files);
                });
            }

            // 파일 처리 함수
            function handleFiles(files) {
                Array.from(files).forEach(file => {
                    if (file.type.startsWith('image/')) {
                        if (file.size <= 10 * 1024 * 1024) { // 10MB 제한
                            addImagePreview(file);
                        } else {
                            showNotification('파일 크기가 너무 큽니다. (최대 10MB)', 'error');
                        }
                    } else {
                        showNotification('이미지 파일만 업로드할 수 있습니다.', 'error');
                    }
                });
            }

            // 이미지 미리보기 추가
            function addImagePreview(file) {
                const reader = new FileReader();
                const imageId = 'img_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

                reader.onload = function(e) {
                    const previewHtml = `
                        <div class="image-preview" data-image-id="${imageId}">
                            <img src="${e.target.result}" alt="이미지 미리보기">
                            <button type="button" class="image-remove" onclick="removeImage('${imageId}')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                    $('#imagePreviewContainer').append(previewHtml);
                    selectedImages.push({id: imageId, file: file});
                };

                reader.readAsDataURL(file);
            }

            // 이미지 제거
            window.removeImage = function(imageId) {
                $(`.image-preview[data-image-id="${imageId}"]`).remove();
                selectedImages = selectedImages.filter(img => img.id !== imageId);
            };

            // 단계별 네비게이션 초기화
            function initializeStepNavigation() {
                $('#nextBtn').on('click', function() {
                    if (validateCurrentStep()) {
                        nextStep();
                    }
                });

                $('#prevBtn').on('click', function() {
                    prevStep();
                });
            }

            // 다음 단계로
            function nextStep() {
                if (currentStep < totalSteps) {
                    $(`#stepContent${currentStep}`).hide();
                    $(`.progress-step:nth-child(${currentStep})`).removeClass('active').addClass('completed');

                    currentStep++;
                    $(`#stepContent${currentStep}`).show();
                    $(`.progress-step:nth-child(${currentStep})`).addClass('active');

                    updateNavigationButtons();
                }
            }

            // 이전 단계로
            function prevStep() {
                if (currentStep > 1) {
                    $(`#stepContent${currentStep}`).hide();
                    $(`.progress-step:nth-child(${currentStep})`).removeClass('active');

                    currentStep--;
                    $(`#stepContent${currentStep}`).show();
                    $(`.progress-step:nth-child(${currentStep})`).removeClass('completed').addClass('active');

                    updateNavigationButtons();
                }
            }

            // 네비게이션 버튼 업데이트
            function updateNavigationButtons() {
                $('#prevBtn').toggle(currentStep > 1);
                $('#nextBtn').toggle(currentStep < totalSteps);
                $('#submitBtn').toggle(currentStep === totalSteps);
            }

            // 현재 단계 유효성 검사
            function validateCurrentStep() {
                const currentStepElement = $(`#stepContent${currentStep}`);
                let isValid = true;

                // 필수 필드 검사
                currentStepElement.find('[required]').each(function() {
                    if (!this.checkValidity()) {
                        $(this).addClass('is-invalid');
                        isValid = false;
                    } else {
                        $(this).removeClass('is-invalid');
                    }
                });

                if (!isValid) {
                    showNotification('필수 항목을 모두 입력해주세요.', 'error');
                }

                return isValid;
            }

            // 폼 유효성 검사 초기화
            function initializeFormValidation() {
                $('#propertyRegisterForm').on('submit', function(e) {
                    e.preventDefault();

                    if (validateForm()) {
                        submitForm();
                    }
                });

                // 실시간 유효성 검사
                $('input, select, textarea').on('blur change', function() {
                    if (this.checkValidity()) {
                        $(this).removeClass('is-invalid');
                    }
                });
            }

            // 전체 폼 유효성 검사
            function validateForm() {
                let isValid = true;

                // 모든 필수 필드 검사
                $('[required]').each(function() {
                    if (!this.checkValidity()) {
                        $(this).addClass('is-invalid');
                        isValid = false;
                    }
                });

                if (!isValid) {
                    showNotification('필수 항목을 모두 입력해주세요.', 'error');
                }

                return isValid;
            }

            // 동적 필드 초기화
            function initializeDynamicFields() {
                $('#propertyType').on('change', function() {
                    const propertyType = $(this).val();
                    if (propertyType) {
                        loadDynamicFields(propertyType);
                    } else {
                        $('#dynamicFields').html(`
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle mr-2"></i>
                                매물 종류를 선택하면 해당하는 추가 정보 필드가 표시됩니다.
                            </div>
                        `);
                    }
                });
            }

            // 동적 필드 로드
            function loadDynamicFields(propertyType) {
                $.ajax({
                    url: '/api/v1/admin/properties/property-type-fields',
                    method: 'GET',
                    data: { type: propertyType },
                    success: function(response) {
                        renderDynamicFields(response.fields);
                    },
                    error: function() {
                        showNotification('추가 정보 필드를 불러오는데 실패했습니다.', 'error');
                    }
                });
            }

            // 동적 필드 렌더링
            function renderDynamicFields(fields) {
                let html = '<div class="row">';

                fields.forEach((field, index) => {
                    if (index % 2 === 0 && index !== 0) {
                        html += '</div><div class="row">';
                    }

                    html += `<div class="col-md-6">
                        <div class="form-group">
                            <label>${field.displayName}</label>`;

                    if (field.fieldType === 'select') {
                        html += `<select class="form-control" name="${field.fieldName}">
                            <option value="">선택하세요</option>`;
                        field.options.forEach(option => {
                            if (option) {
                                html += `<option value="${option}">${option}</option>`;
                            }
                        });
                        html += `</select>`;
                    } else if (field.fieldType === 'number') {
                        html += `<input type="number" class="form-control" name="${field.fieldName}" placeholder="${field.displayName}를 입력하세요">`;
                    } else {
                        html += `<input type="text" class="form-control" name="${field.fieldName}" placeholder="${field.displayName}를 입력하세요">`;
                    }

                    html += `</div></div>`;
                });

                html += '</div>';
                $('#dynamicFields').html(html);
            }

            // 폼 제출
            function submitForm() {
                const formData = new FormData();

                // 폼 데이터 수집
                $('#propertyRegisterForm').find('input, select, textarea').each(function() {
                    const name = $(this).attr('name');
                    const value = $(this).val();

                    if (name && value) {
                        formData.append(name, value);
                    }
                });

                // 이미지 파일 추가
                selectedImages.forEach((imageData, index) => {
                    formData.append('images', imageData.file);
                });

                // AJAX 제출
                $.ajax({
                    url: '/api/v1/admin/properties',
                    method: 'POST',
                    data: formData,
                    contentType: false,
                    processData: false,
                    beforeSend: function() {
                        $('#submitBtn').prop('disabled', true).html('<i class="fas fa-spinner fa-spin mr-2"></i>등록 중...');
                    },
                    success: function(response) {
                        showNotification('매물이 성공적으로 등록되었습니다.', 'success');
                        setTimeout(() => {
                            window.location.href = '/admin/properties';
                        }, 2000);
                    },
                    error: function(xhr) {
                        const errorMsg = xhr.responseJSON?.message || '매물 등록 중 오류가 발생했습니다.';
                        showNotification(errorMsg, 'error');
                    },
                    complete: function() {
                        $('#submitBtn').prop('disabled', false).html('<i class="fas fa-save mr-2"></i>등록하기');
                    }
                });
            }

            // 주소 검색 초기화
            function initializeAddressSearch() {
                $('#addressSearchBtn').on('click', function() {
                    new daum.Postcode({
                        oncomplete: function(data) {
                            // 우편번호와 주소 정보를 입력
                            $('#postalCode').val(data.zonecode);
                            $('#roadAddress').val(data.roadAddress);
                            $('#jibunAddress').val(data.jibunAddress);

                            // 기본 주소 선택 (도로명 우선, 없으면 지번)
                            const baseAddress = data.roadAddress || data.jibunAddress;
                            $('#address').val(baseAddress);
                            $('#address').removeClass('is-invalid');

                            // 좌표 변환 (Daum Geocoder API 사용)
                            getCoordinates(baseAddress);

                            // 상세주소 입력란으로 포커스 이동
                            $('#detailAddress').focus();
                        }
                    }).open();
                });
            }

            // 좌표 가져오기 (Kakao Maps Geocoder 사용)
            function getCoordinates(address) {
                // Kakao Maps API를 사용하여 좌표 변환
                $.ajax({
                    url: 'https://dapi.kakao.com/v2/local/search/address.json',
                    type: 'GET',
                    headers: {
                        'Authorization': 'f6bac5696b9306e5fb34acef74db15b1' // 실제 사용시 카카오 API 키 필요
                    },
                    data: {
                        query: address
                    },
                    success: function(response) {
                        if (response.documents && response.documents.length > 0) {
                            const result = response.documents[0];
                            $('#latitude').val(result.y);
                            $('#longitude').val(result.x);
                            console.log('좌표 설정 완료:', result.y, result.x);
                        } else {
                            // 좌표를 찾을 수 없는 경우 기본값 설정 (창원시청 좌표)
                            $('#latitude').val('35.2276');
                            $('#longitude').val('128.6811');
                            showNotification('정확한 좌표를 찾을 수 없어 기본 좌표로 설정됩니다.', 'warning');
                        }
                    },
                    error: function() {
                        // API 호출 실패시 주소 정보로부터 대략적인 좌표 추정
                        // 창원시 중심 좌표 사용
                        $('#latitude').val('35.2276');
                        $('#longitude').val('128.6811');
                        console.log('좌표 API 호출 실패, 기본 좌표 사용');
                    }
                });
            }

            // 알림 표시
            function showNotification(message, type) {
                const alertClass = type === 'error' ? 'alert-danger' : (type === 'warning' ? 'alert-warning' : 'alert-success');
                const iconClass = type === 'error' ? 'fa-exclamation-triangle' : (type === 'warning' ? 'fa-exclamation-circle' : 'fa-check-circle');

                const notification = $(`
                    <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                        <i class="fas ${iconClass} mr-2"></i>${message}
                        <button type="button" class="close" data-dismiss="alert">
                            <span>&times;</span>
                        </button>
                    </div>
                `);

                $('#propertyRegisterForm').prepend(notification);

                // 3초 후 자동 제거
                setTimeout(() => {
                    notification.alert('close');
                }, 3000);
            }
        });
        /*]]>*/
        </script>
    </th:block>
</body>
</html>